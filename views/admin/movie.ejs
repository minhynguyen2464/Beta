<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>

    <nav class="navbar navbar-dark bg-dark">
        <span class="navbar-brand mb-0 h1">Admin Panel</span>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-2 d-none d-md-block bg-light sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                Users
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                Products
                            </a>
                        </li>
                        <!-- Add more menu items as needed -->
                    </ul>
                </div>
            </nav>

            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                <!-- Main content goes here -->
                <h1 class="row justify-content-center">Movie Form</h1>
                <div class="row justify-content-center">
                    <form enctype="multipart/form-data" class="movie-form" id="movieForm">
                        <!-- Movie Title -->
                        <div class="form-group">
                            <label for="title">Title:</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>

                        <!-- Director -->
                        <div class="form-group">
                            <label for="director">Director:</label>
                            <input type="text" class="form-control" id="director" name="director" required>
                        </div>

                        <!-- Cast -->
                        <div class="form-group">
                            <label for="cast">Cast (comma-separated):</label>
                            <input type="text" class="form-control" id="cast" name="cast" required>
                        </div>

                        <!-- Genre (comma-separated) -->
                        <div class="form-group">
                            <label for="genre">Genre (comma-separated):</label>
                            <input type="text" class="form-control" id="genre" name="genre" required>
                        </div>

                        <!-- Duration (in minutes) -->
                        <div class="form-group">
                            <label for="duration">Duration (minutes):</label>
                            <input type="number" class="form-control" id="duration" name="duration" required>
                        </div>

                        <!-- Language -->
                        <div class="form-group">
                            <label for="language">Language:</label>
                            <input type="text" class="form-control" id="language" name="language" required>
                        </div>

                        <!-- Release Year -->
                        <div class="form-group">
                            <label for="releaseYear">Release Year:</label>
                            <input type="date" class="form-control" id="releaseYear" name="releaseYear" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Movie Description:</label>
                            <textarea class="form-control" id="description" name="description" rows="3"
                                required></textarea>
                        </div>
                        <!-- Movie Poster -->
                        <div class="form-group">
                            <label for="poster">Movie Poster:</label>
                            <input type="file" class="form-control-file" id="poster" name="poster" accept="image/*">
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="white_shd">
                            <div class="graph_head">
                                <h2>Movie</h2>
                            </div <div class="table_section padding_infor_info">
                            <div class="table-responsive-sm">
                                <table class="table" id="moviesTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Director</th>
                                            <th>Cast</th>
                                            <th>Genre</th>
                                            <th>Duration (min)</th>
                                            <th>Language</th>
                                            <th>Release Year</th>
                                            <th>Description</th>
                                            <th>Poster</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Example row (replace with dynamic data) -->
                                        <tr>
                                            <td>1</td>
                                            <td>Movie Title</td>
                                            <td>Director Name</td>
                                            <td>Actor1, Actor2</td>
                                            <td>Genre1, Genre2</td>
                                            <td>120</td>
                                            <td>English</td>
                                            <td>2022-01-01</td>
                                            <td>Lorem ipsum dolor sit amet consectetur adipisicing elit. Unde sequi ab
                                                sed iure ut enim aspernatur, sit cum aut omnis.</td>
                                            <td><img src="poster_url.jpg" alt="Movie Poster" style="max-width: 100px;">
                                            </td>
                                        </tr>
                                        <!-- Repeat the above row structure for each movie -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        </main>
    </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const form = document.getElementById('movieForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = {
                title: document.getElementById('title').value,
                director: document.getElementById('director').value,
                cast: document.getElementById('cast').value,
                genre: document.getElementById('genre').value,
                duration: document.getElementById('duration').value,
                language: document.getElementById('language').value,
                releaseYear: document.getElementById('releaseYear').value,
                description: document.getElementById('description').value,
                poster: document.getElementById('poster').files[0], // Assuming file input for poster
            };
            console.log(formData);
            axios.post('/admin/api/movie', formData, {
                headers: {
                    'Content-Type': 'multipart/form-data'
                }
            })
                .then((res) => {
                    console.log('Response data:', res.data);
                    alert("Thêm phim thành công");
                    window.location.reload(true);
                })
                .catch((err) => {
                    console.log('Error:', err);
                })
        })
        axios.get('/admin/api/movie')
            .then(res => {
                const movies = res.data;
                renderMoviesTable(movies);
            })
            .catch(err => {
                console.error('Error fetching movies:', error);

            })

        function renderMoviesTable(movies) {
            const tableBody = document.querySelector('#moviesTable tbody');

            // Clear existing rows
            tableBody.innerHTML = '';

            // Loop through movies and add rows to the table
            movies.forEach(movie => {
                const row = tableBody.insertRow();
                // Add cells with movie data
                const path = '../images/' + movie.poster
                row.insertCell().textContent = 1;
                row.insertCell().textContent = movie.title;
                row.insertCell().textContent = movie.director;
                row.insertCell().textContent = movie.cast.join(', ');
                row.insertCell().textContent = movie.genre.join(', ');
                row.insertCell().textContent = movie.duration;
                row.insertCell().textContent = movie.language;
                row.insertCell().textContent = new Date(movie.releaseYear).toLocaleDateString();
                row.insertCell().textContent = movie.description;
                row.insertCell().innerHTML = `<img src="${path}" alt="Movie Poster" style="max-width: 100px;">`;
            });
        }
    </script>
</body>

</html>